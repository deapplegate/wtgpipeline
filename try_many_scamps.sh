#!/bin/bash
set -xv

posangle=1.0
position=1.0
pixscale=1.003
#-POSITION_MAXERR 5.0 -POSANGLE_MAXERR 0.07 -PIXSCALE_MAXERR 1.03
cd ~/my_data/SUBARU/MACS0429-02/W-J-B/SCIENCE/astrom_photom_scamp_PANSTARRS/headers
cp ~/wtgpipeline/scamp.xsl ../plots
for posangle in 1.0 5.0 90.0 0.2 0.4 0.07
do
	ending=posangle_${posangle}_position_${position}_pixscale_${pixscale}_scamp
	#/afs/slac/g/ki/software/local/bin/scamp ../cat/SUPA0154650_scamp.cat ../cat/SUPA0154641_scamp.cat ../cat/SUPA0154644_scamp.cat ../cat/SUPA0154647_scamp.cat ../cat/SUPA0154640_scamp.cat ../cat/SUPA0154639_scamp.cat ../cat/SUPA0050800_scamp.cat ../cat/SUPA0050796_scamp.cat ../cat/SUPA0043642_scamp.cat ../cat/SUPA0043643_scamp.cat ../cat/SUPA0043636_scamp.cat ../cat/SUPA0154635_scamp.cat ../cat/SUPA0043648_scamp.cat ../cat/SUPA0043649_scamp.cat ../cat/SUPA0043650_scamp.cat ../cat/SUPA0154632_scamp.cat ../cat/SUPA0154630_scamp.cat ../cat/SUPA0154628_scamp.cat ../cat/SUPA0154629_scamp.cat ../cat/SUPA0154627_scamp.cat ../cat/SUPA0154625_scamp.cat ../cat/SUPA0154653_scamp.cat ../cat/SUPA0154652_scamp.cat ../cat/SUPA0154651_scamp.cat ../cat/SUPA0154648_scamp.cat ../cat/SUPA0154649_scamp.cat ../cat/SUPA0154645_scamp.cat ../cat/SUPA0154646_scamp.cat ../cat/SUPA0154643_scamp.cat ../cat/SUPA0154642_scamp.cat ../cat/SUPA0154638_scamp.cat ../cat/SUPA0050801_scamp.cat ../cat/SUPA0050798_scamp.cat ../cat/SUPA0050799_scamp.cat ../cat/SUPA0050797_scamp.cat ../cat/SUPA0050792_scamp.cat ../cat/SUPA0043639_scamp.cat ../cat/SUPA0043640_scamp.cat ../cat/SUPA0043641_scamp.cat ../cat/SUPA0043638_scamp.cat ../cat/SUPA0043646_scamp.cat ../cat/SUPA0043647_scamp.cat ../cat/SUPA0043637_scamp.cat ../cat/SUPA0043645_scamp.cat ../cat/SUPA0154634_scamp.cat ../cat/SUPA0154636_scamp.cat ../cat/SUPA0154633_scamp.cat ../cat/SUPA0154631_scamp.cat ../cat/SUPA0154626_scamp.cat -c /afs/slac/u/ki/anja/software/ldacpipeline-0.12.20/conf/reduction/scamp_astrom_photom.scamp -ASTRINSTRU_KEY FILTER,INSTRUM,CONFIG,ROTATION,MISSCHIP,PPRUN -CDSCLIENT_EXEC /afs/slac.stanford.edu/g/ki/software/cdsclient/bin/aclient_cgi -NTHREADS 4 -MOSAIC_TYPE FIX_FOCALPLANE -XML_NAME MACS0429-02_scamp.xml -MAGZERO_INTERR 0.1 -MAGZERO_REFERR 0.03 -POSITION_MAXERR 5.0 -POSANGLE_MAXERR 0.07 -SN_THRESHOLDS 3,100 -FLAGS_MASK 0x00e0 -MATCH_NMAX 10000 -CROSSID_RADIUS 0.3 -PIXSCALE_MAXERR 1.03 -DISTORT_DEGREES 3 -ASTREF_WEIGHT 1 -STABILITY_TYPE INSTRUMENT -ASTREF_CATALOG FILE -ASTREFCAT_NAME astrefcat.cat -ASTREFCENT_KEYS raMean,decMean -ASTREFERR_KEYS raMeanErr,decMeanErr -ASTREFMAG_LIMITS 13,30 -ASTREFMAG_KEY iMeanApMag -ASTREFMAGERR_KEY iMeanApMagErr -CHECKPLOT_RES 4000,3000
	/afs/slac/g/ki/software/local/bin/scamp ../cat/SUPA0154650_scamp.cat ../cat/SUPA0154641_scamp.cat ../cat/SUPA0154644_scamp.cat ../cat/SUPA0154647_scamp.cat ../cat/SUPA0154640_scamp.cat ../cat/SUPA0154639_scamp.cat ../cat/SUPA0050800_scamp.cat ../cat/SUPA0050796_scamp.cat ../cat/SUPA0043642_scamp.cat ../cat/SUPA0043643_scamp.cat ../cat/SUPA0043636_scamp.cat ../cat/SUPA0154635_scamp.cat ../cat/SUPA0043648_scamp.cat ../cat/SUPA0043649_scamp.cat ../cat/SUPA0043650_scamp.cat ../cat/SUPA0154632_scamp.cat ../cat/SUPA0154630_scamp.cat ../cat/SUPA0154628_scamp.cat ../cat/SUPA0154629_scamp.cat ../cat/SUPA0154627_scamp.cat ../cat/SUPA0154625_scamp.cat ../cat/SUPA0154653_scamp.cat ../cat/SUPA0154652_scamp.cat ../cat/SUPA0154651_scamp.cat ../cat/SUPA0154648_scamp.cat ../cat/SUPA0154649_scamp.cat ../cat/SUPA0154645_scamp.cat ../cat/SUPA0154646_scamp.cat ../cat/SUPA0154643_scamp.cat ../cat/SUPA0154642_scamp.cat ../cat/SUPA0154638_scamp.cat ../cat/SUPA0050801_scamp.cat ../cat/SUPA0050798_scamp.cat ../cat/SUPA0050799_scamp.cat ../cat/SUPA0050797_scamp.cat ../cat/SUPA0050792_scamp.cat ../cat/SUPA0043639_scamp.cat ../cat/SUPA0043640_scamp.cat ../cat/SUPA0043641_scamp.cat ../cat/SUPA0043638_scamp.cat ../cat/SUPA0043646_scamp.cat ../cat/SUPA0043647_scamp.cat ../cat/SUPA0043637_scamp.cat ../cat/SUPA0043645_scamp.cat ../cat/SUPA0154634_scamp.cat ../cat/SUPA0154636_scamp.cat ../cat/SUPA0154633_scamp.cat ../cat/SUPA0154631_scamp.cat ../cat/SUPA0154626_scamp.cat -c /afs/slac/u/ki/anja/software/ldacpipeline-0.12.20/conf/reduction/scamp_astrom_photom.scamp -ASTRINSTRU_KEY FILTER,INSTRUM,CONFIG,ROTATION,MISSCHIP,PPRUN -CDSCLIENT_EXEC /afs/slac.stanford.edu/g/ki/software/cdsclient/bin/aclient_cgi -NTHREADS 4 -MOSAIC_TYPE FIX_FOCALPLANE -MAGZERO_INTERR 0.1 -MAGZERO_REFERR 0.03 -SN_THRESHOLDS 3,100 -FLAGS_MASK 0x00e0 -MATCH_NMAX 10000 -CROSSID_RADIUS 0.3 -DISTORT_DEGREES 3 -ASTREF_WEIGHT 1 -STABILITY_TYPE INSTRUMENT -ASTREF_CATALOG FILE -ASTREFCAT_NAME astrefcat.cat -ASTREFCENT_KEYS raMean,decMean -ASTREFERR_KEYS raMeanErr,decMeanErr -ASTREFMAG_LIMITS 13,30 -ASTREFMAG_KEY iMeanApMag -ASTREFMAGERR_KEY iMeanApMagErr \
	-CHECKPLOT_RES 2000,1500 \
	-POSITION_MAXERR ${position} \
	-POSANGLE_MAXERR ${posangle} \
	-PIXSCALE_MAXERR ${pixscale} \
	-XML_NAME ${ending}.xml
	# /afs/slac/g/ki/software/local/bin/scamp ../cat/SUPA0154650_scamp.cat ../cat/SUPA0154641_scamp.cat ../cat/SUPA0154644_scamp.cat ../cat/SUPA0154647_scamp.cat ../cat/SUPA0154640_scamp.cat ../cat/SUPA0154639_scamp.cat ../cat/SUPA0050800_scamp.cat ../cat/SUPA0050796_scamp.cat ../cat/SUPA0043642_scamp.cat ../cat/SUPA0043643_scamp.cat ../cat/SUPA0043636_scamp.cat ../cat/SUPA0154635_scamp.cat ../cat/SUPA0043648_scamp.cat ../cat/SUPA0043649_scamp.cat ../cat/SUPA0043650_scamp.cat ../cat/SUPA0154632_scamp.cat ../cat/SUPA0154630_scamp.cat ../cat/SUPA0154628_scamp.cat ../cat/SUPA0154629_scamp.cat ../cat/SUPA0154627_scamp.cat ../cat/SUPA0154625_scamp.cat ../cat/SUPA0154653_scamp.cat ../cat/SUPA0154652_scamp.cat ../cat/SUPA0154651_scamp.cat ../cat/SUPA0154648_scamp.cat ../cat/SUPA0154649_scamp.cat ../cat/SUPA0154645_scamp.cat ../cat/SUPA0154646_scamp.cat ../cat/SUPA0154643_scamp.cat ../cat/SUPA0154642_scamp.cat ../cat/SUPA0154638_scamp.cat ../cat/SUPA0050801_scamp.cat ../cat/SUPA0050798_scamp.cat ../cat/SUPA0050799_scamp.cat ../cat/SUPA0050797_scamp.cat ../cat/SUPA0050792_scamp.cat ../cat/SUPA0043639_scamp.cat ../cat/SUPA0043640_scamp.cat ../cat/SUPA0043641_scamp.cat ../cat/SUPA0043638_scamp.cat ../cat/SUPA0043646_scamp.cat ../cat/SUPA0043647_scamp.cat ../cat/SUPA0043637_scamp.cat ../cat/SUPA0043645_scamp.cat ../cat/SUPA0154634_scamp.cat ../cat/SUPA0154636_scamp.cat ../cat/SUPA0154633_scamp.cat ../cat/SUPA0154631_scamp.cat ../cat/SUPA0154626_scamp.cat -c /afs/slac/u/ki/anja/software/ldacpipeline-0.12.20/conf/reduction/scamp_astrom_photom.scamp -ASTRINSTRU_KEY FILTER,INSTRUM,CONFIG,ROTATION,MISSCHIP,PPRUN -CDSCLIENT_EXEC /afs/slac.stanford.edu/g/ki/software/cdsclient/bin/aclient_cgi -NTHREADS 4 -MOSAIC_TYPE FIX_FOCALPLANE -XML_NAME MACS0429-02_scamp.xml -MAGZERO_INTERR 0.1 -MAGZERO_REFERR 0.03 -POSITION_MAXERR 5.0 -POSANGLE_MAXERR 0.07 -SN_THRESHOLDS 3,100 -FLAGS_MASK 0x00e0 -MATCH_NMAX 10000 -CROSSID_RADIUS 0.3 -PIXSCALE_MAXERR 1.03 -DISTORT_DEGREES 3 -ASTREF_WEIGHT 1 -STABILITY_TYPE INSTRUMENT -ASTREF_CATALOG FILE -ASTREFCAT_NAME astrefcat.cat -ASTREFCENT_KEYS raMean,decMean -ASTREFERR_KEYS raMeanErr,decMeanErr -ASTREFMAG_LIMITS 13,30 -ASTREFMAG_KEY iMeanApMag -ASTREFMAGERR_KEY iMeanApMagErr -CHECKPLOT_RES 4000,3000
	#
	#/afs/slac/g/ki/software/local/bin/scamp ../cat/SUPA0109617_scamp.cat ../cat/SUPA0109618_scamp.cat ../cat/SUPA0109619_scamp.cat ../cat/SUPA0109620_scamp.cat ../cat/SUPA0120015_scamp.cat ../cat/SUPA0120016_scamp.cat ../cat/SUPA0120017_scamp.cat ../cat/SUPA0120018_scamp.cat ../cat/SUPA0120019_scamp.cat ../cat/SUPA0120142_scamp.cat ../cat/SUPA0120143_scamp.cat ../cat/SUPA0120144_scamp.cat ../cat/SUPA0120145_scamp.cat ../cat/SUPA0120146_scamp.cat ../cat/SUPA0120147_scamp.cat ../cat/SUPA0120148_scamp.cat ../cat/SUPA0120149_scamp.cat ../cat/SUPA0120150_scamp.cat ../cat/SUPA0120151_scamp.cat ../cat/SUPA0120152_scamp.cat ../cat/SUPA0120153_scamp.cat ../cat/SUPA0109600_scamp.cat ../cat/SUPA0109601_scamp.cat ../cat/SUPA0109602_scamp.cat ../cat/SUPA0109603_scamp.cat ../cat/SUPA0109604_scamp.cat ../cat/SUPA0109605_scamp.cat ../cat/SUPA0109606_scamp.cat ../cat/SUPA0109607_scamp.cat ../cat/SUPA0109608_scamp.cat ../cat/SUPA0109609_scamp.cat ../cat/SUPA0109610_scamp.cat ../cat/SUPA0109611_scamp.cat ../cat/SUPA0109612_scamp.cat ../cat/SUPA0109613_scamp.cat ../cat/SUPA0109614_scamp.cat ../cat/SUPA0109615_scamp.cat ../cat/SUPA0120021_scamp.cat ../cat/SUPA0120022_scamp.cat ../cat/SUPA0120023_scamp.cat ../cat/SUPA0120024_scamp.cat ../cat/SUPA0120025_scamp.cat ../cat/SUPA0120026_scamp.cat ../cat/SUPA0120027_scamp.cat ../cat/SUPA0120028_scamp.cat ../cat/SUPA0120029_scamp.cat ../cat/SUPA0120030_scamp.cat ../cat/SUPA0120031_scamp.cat ../cat/SUPA0120032_scamp.cat ../cat/SUPA0120033_scamp.cat ../cat/SUPA0120034_scamp.cat ../cat/SUPA0120035_scamp.cat ../cat/SUPA0120036_scamp.cat ../cat/SUPA0120037_scamp.cat ../cat/SUPA0120038_scamp.cat -c /afs/slac/u/ki/anja/software/ldacpipeline-0.12.20/conf/reduction/scamp_astrom_photom.scamp -ASTRINSTRU_KEY FILTER,INSTRUM,CONFIG,ROTATION,MISSCHIP,PPRUN -CDSCLIENT_EXEC /afs/slac.stanford.edu/g/ki/software/cdsclient/bin/aclient_cgi -NTHREADS 4 -MOSAIC_TYPE FIX_FOCALPLANE 
	plotfiles=`\ls *.png`
	for plotfl in ${plotfiles}
	do
		base=`basename ${plotfl} .png`
		mv ${plotfl} ../plots/${base}_${ending}.png
		sed -i.old "s/${plotfl}/${base}_${ending}.png/g" ${ending}.xml
		sed -i.old 's/href=".*"?>/href="scamp.xsl"?>/g' ${ending}.xml
	done
	mv ${ending}.xml ../plots
	mkdir ../headers_${ending}
	mv ../cat/*.head ../headers_${ending}
done


#astr_chi2_1.png astr_interror1d_1.png astr_interror2d_1.png astr_referror1d_1.png astr_referror2d_1.png astr_refsysmap_1.png astr_refsysmap_2.png astr_refsysmap_3.png astr_refsysmap_4.png astr_refsysmap_5.png astr_refsysmap_6.png distort_1.png distort_2.png distort_3.png distort_4.png distort_5.png distort_6.png fgroups_1.png phot_errorvsmag_1.png phot_zpcorr_1.png psphot_error_1.png
